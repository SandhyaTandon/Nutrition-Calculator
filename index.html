<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
    <meta charset="utf-8" />
    <title>Nutrient Label Calculator</title>

    <!-- css Stylesheets-->
    <link rel="stylesheet" href="styles.css" />
    <link
      rel="stylesheet"
      href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css"
    />

    <!-- bootstrap scripts -->
    <script
      src="https://code.jquery.com/jquery-3.5.1.min.js"
      integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0="
      crossorigin="anonymous"
    ></script>
    <script
      src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"
      integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js"
      integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6"
      crossorigin="anonymous"
    ></script>
  </head>

  <body>
    <!-- steps section -->
    <section id="steps">
      <div class="row container-fluid steps-div">
        <div class="col-lg-4">
          <img
            src="https://www.verywellfit.com/static/4.151.0/image/recipe_analyzer_step1.png"
            class="steps-image"
          />
          <span>Enter Your Ingredients</span>
        </div>
        <div class="col-lg-4">
          <img
            src="https://www.verywellfit.com/static/4.151.0/image/recipe_analyzer_step2.png"
            class="steps-image"
          />
          <span>Click on 'Analyze Recipe'</span>
        </div>
        <div class="col-lg-4">
          <img
            src="https://www.verywellfit.com/static/4.151.0/image/recipe_analyzer_step3.png"
            class="steps-image"
          />
          <span>Get Your Nutrition Facts Label</span>
        </div>
      </div>
    </section>

    <section id="calculator-body">
      <div class="container-fluid" id="box1">
        <div class="card">
          <div class="card-body">
            <h4>Enter Recipe Name (optional)</h4>
            <input class="recipe-name" id="recipeName" />
            <div class="raw-data">
              <header>
                <h3>Enter Recipe Ingredients</h3>
                <a class="btn-sample">Try a Sample Recipe</a>
              </header>
              <textarea rows="10" id="recipeIngredients"></textarea>
              <div id="servings_1-1" class="comp servings">
                <div class="serving-number">
                  <h4>Select Number of Servings</h4>
                  <div class="select">
                    <select id="numOfServing">
                      <option
                        value="null"
                        selected="selected"
                        disabled="disabled"
                        hidden="hidden"
                      >
                        ---
                      </option>
                    </select>
                  </div>
                </div>
                <div class="serving-size">
                  <h4>Enter serving size (optional)</h4>
                  <input
                    placeholder="e.g. 2 cups, 1 tablespoon"
                    class="serving-size-quantity"
                    id="servingSize"
                  />
                </div>
              </div>
              <button
                class="btn btn-padded btn-submit btn-primary"
                id="analyze"
              >
                Analyze Recipe
              </button>
            </div>
            <div id="nutrientResult">
              <br />
              <br />
              <div class="row">
                <div class="col-sm">
                  Recipe Analyzer Results <br />
                  A single serving of this recipe has
                  <span class="calories"></span> calories. <br />
                  Read through the nutrition label for a snapshot of this
                  recipe's nutritional profile. If the label lists less than 5
                  percent daily value for a nutrient it is considered low, while
                  20 percent or more is high. In general, you want to limit
                  saturated fat, cholesterol, and sodium, and get enough fiber,
                  vitamins, and minerals.
                </div>
                <div class="col-sm">
                  <div class="card">
                    <div class="card-body">
                      Nutrition Facts <br />
                      Servings: <span id="serving"></span><br />
                      Amount per serving <br />
                      Calories <span class="calories"></span> <br />
                      <span>% Daily Value*</span> <br />
                      Total Fat <span id="totalFat"></span> <br />
                      Saturated Fat <span id="saturatedFat"></span> <br />
                      Cholesterol <span id="cholestrol"></span> <br />
                      Sodium <span id="sodium"></span> <br />
                      Total Carbohydrate <span id="totalCarbs"></span> <br />
                      Dietary Fiber <span id="dietaryFiber"></span> <br />
                      Total Sugars <span id="totalSugar"></span> <br />
                      Protein <span id="protein"></span> <br />
                    </div>
                  </div>
                </div>
              </div>
              <button class="btn btn-padded btn-submit btn-primary" id="clear">
                Clear Recipe
              </button>
            </div>
          </div>
        </div>
      </div>
    </section>
  </body>
  <script>
    let select = document.getElementById("numOfServing");
    for (let i = 1; i <= 72; i++) {
      let opt = document.createElement("option");
      opt.value = i;
      opt.innerHTML = i;
      select.appendChild(opt);
    }

    $("#nutrientResult").hide();

    $("#analyze").click(function() {
      let arrayOfLines = $("#recipeIngredients")
        .val()
        .split("\n");
      let numOfServing = $("#numOfServing").val();
      let recipeName = $("#recipeName").val();
      let jsonObj = {
        title: recipeName,
        ingr: arrayOfLines,
        yield: numOfServing
      };
      let jsonobj = JSON.stringify(jsonObj);
      const xhr = new XMLHttpRequest();
      xhr.open(
        "POST",
        "https://api.edamam.com/api/nutrition-details?app_id=4426de42&app_key=345b8cfd43f0f84956e187cdfeacb13d"
      );
      xhr.setRequestHeader("Content-Type", "application/json");
      xhr.onload = function() {
        let jsonResponse = xhr.response;
        let responseObj = JSON.parse(jsonResponse);
        console.log(responseObj);
        if(responseObj.error){
          alert("Low quality input");
        }
        else{
        $("#nutrientResult").show();
        $("#serving").html(responseObj.yield);
        $(".calories").html(responseObj.calories);
        $("#totalFat").html(responseObj.totalNutrients.FAT.quantity.toFixed(2));
        $("#saturatedFat").html(
          responseObj.totalNutrients.FASAT.quantity.toFixed(2)
        );
        $("#cholestrol").html(
          responseObj.totalNutrients.CHOLE.quantity.toFixed(2)
        );
        $("#sodium").html(responseObj.totalNutrients.NA.quantity.toFixed(2));
        $("#totalCarbs").html(
          responseObj.totalNutrients.CHOCDF.quantity.toFixed(2)
        );
        $("#dietaryFiber").html(
          responseObj.totalNutrients.FIBTG.quantity.toFixed(2)
        );
        $("#totalSugar").html(
          responseObj.totalNutrients.SUGAR.quantity.toFixed(2)
        );
        $("#protein").html(
          responseObj.totalNutrients.PROCNT.quantity.toFixed(2)
        );
      };
    }
      xhr.send(jsonobj);
    });


    $("#clear").click(function() {
      $("#recipeIngredients").val("");
      $("#recipeName").val("");
      $("#numOfServing").val(null);
      $("#servingSize").val("");
      $("#nutrientResult").hide();
    });
  </script>
</html>
